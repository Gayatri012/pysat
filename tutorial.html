

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; pysat 0.4.4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pysat 0.4.4 documentation" href="index.html"/>
        <link rel="next" title="Code Examples" href="examples.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pysat
          

          
          </a>

          
            
            
              <div class="version">
                0.4.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-functions">Custom Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#time-series-analysis">Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iteration">Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#orbit-support">Orbit Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iteration-and-instrument-independent-analysis">Iteration and Instrument Independent Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary-flow-charts">Summary Flow Charts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Code Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_instruments.html">Supported Instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_instrument.html">Adding a New Instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_instrument.html#supported-data-templates">Supported Data Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">pysat</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>The core functionality of pysat is exposed through the pysat.Instrument object. The intent of the Instrument object is to offer a single interface for interacting with science data that is independent of measurement platform. The layer of abstraction presented by the Instrument object allows for things to occur in the background that can make science data analysis simpler and more rigorous.</p>
<p>To begin,</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pysat</span>
</pre></div>
</div>
<p>The data directory pysat looks in for data (pysat_data_dir) needs to be set upon the first import,</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_data_dir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_to_existing_directory</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Instantiation</strong></p>
<hr class="docutils" />
<p>To create a pysat.Instrument object, select a platform, instrument name, and measurement type to be analyzed from the list of <a class="reference internal" href="supported_instruments.html"><span class="doc">Supported Instruments</span></a>. To work with Magnetometer data from the Vector Electric Field Instrument onboard the Communications/Navigation Outage Forecasting System (C/NOFS), use:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vefi&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dc_b&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Behind the scenes pysat uses a python module named cnofs_vefi that understands how to interact with &#8216;dc_b&#8217; data. VEFI also measures electric fields in several modes that offer different data products. Though these measurements are not currently supported by the cnofs_vefi module, when they are, they can be selected via the tag string.</p>
<p>To load measurements from a different instrument on C/NOFS, the Ion Velocity Meter, which measures thermal plasma parameters, use:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ivm</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ivm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the background pysat uses the module cnofs_ivm to handle this data. There is only one measurement option from IVM, so no tag string is required.</p>
<p>Measurements from a constellation of COSMIC satellites are also available. These satellites measure GPS signals as they travel through the atmosphere. A number of different data sets are available from COSMIC, and are also supported by the relevant module.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># electron density profiles</span>
<span class="n">cosmic</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cosmic2013&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gps&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;ionprf&#39;</span><span class="p">)</span>
<span class="c1"># atmosphere profiles</span>
<span class="n">cosmic</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cosmic2013&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gps&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;atmprf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Though the particulars of VEFI magnetometer data, IVM plasma parameters, and COSMIC atmospheric measurements are going to be quite different, the processes demonstrated below with VEFI also apply equally to IVM and COSMIC.</p>
<p><strong>Download</strong></p>
<hr class="docutils" />
<p>Let&#8217;s download some data. VEFI data is hosted by the NASA Coordinated Data Analysis Web (CDAWeb) at <a class="reference external" href="http://cdaweb.gsfc.nasa.gov">http://cdaweb.gsfc.nasa.gov</a>. The proper process for downloading VEFI data is built into the cnofs_vefi module, which is handled by pysat. All we have to do is invoke the .download method attached to the VEFI object, or any other pysat Instrument.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># define date range to download data and download</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

<span class="c1"># download COSMIC data, which requires username and password</span>
<span class="n">cosmic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<p>The data is downloaded to pysat_data_dir/platform/name/tag/, in this case pysat_data_dir/cnofs/vefi/dc_b/. At the end of the download, pysat will update the list of files associated with VEFI.</p>
<p><strong>Load Data</strong></p>
<hr class="docutils" />
<p>Data is loaded into vefi using the .load method using year, day of year; date; or filename.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">126</span><span class="p">)</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;cnofs_vefi_bfield_1sec_20090506_v05.cdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the pysat load routine runs it stores the instrument data into vefi.data. The data structure is a pandas <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dataframe">DataFrame</a>, a highly capable structure with labeled rows and columns. Convenience access to the data is also available at the instrument level.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># all data</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># particular magnetic component</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dB_mer</span>

<span class="c1"># Convenience access</span>
<span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span>
<span class="c1"># slicing</span>
<span class="n">vefi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span>
<span class="c1"># slicing by date time</span>
<span class="n">vefi</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="api.html#pysat.Instrument" title="pysat.Instrument"><code class="xref any py py-class docutils literal"><span class="pre">Instrument</span></code></a> for more.</p>
<p>To load data over a season, pysat provides a convenience function that returns an array of dates over a season. The season need not be continuous.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># create empty series to hold result</span>
<span class="n">mean_dB</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="c1"># get list of dates between start and stop</span>
<span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="c1"># iterate over season, calculate the mean absolute perturbation in</span>
<span class="c1"># meridional magnetic field</span>
<span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
     <span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
         <span class="c1"># isolate data to locations near geographic equator</span>
         <span class="n">idx</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span>
         <span class="n">vefi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
         <span class="c1"># compute mean absolute db_Mer using pandas functions and store</span>
         <span class="n">mean_dB</span><span class="p">[</span><span class="n">vefi</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># plot the result using pandas functionality</span>
<span class="n">mean_dB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mean Absolute Perturbation in Meridional Magnetic Field&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Perturbation (&#39;</span><span class="o">+</span><span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note, the numpy.where may be removed using the convenience access to the attached pandas data object.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">idx</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">vefi</span><span class="p">[(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>
</div>
<p><strong>Clean Data</strong></p>
<hr class="docutils" />
<p>Before data is available in .data it passes through an instrument specific cleaning routine. The amount of cleaning is set by the clean_level keyword,</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vefi&#39;</span><span class="p">,</span>
                        <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dc_b&#39;</span><span class="p">,</span> <span class="n">clean_level</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Four levels of cleaning may be specified,</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>clean_level</strong></td>
<td><strong>Result</strong></td>
</tr>
<tr class="row-even"><td>clean</td>
<td>Generally good data</td>
</tr>
<tr class="row-odd"><td>dusty</td>
<td>Light cleaning, use with care</td>
</tr>
<tr class="row-even"><td>dirty</td>
<td>Minimal cleaning, use with caution</td>
</tr>
<tr class="row-odd"><td>none</td>
<td>No cleaning, use at your own risk</td>
</tr>
</tbody>
</table>
<p><strong>Metadata</strong></p>
<hr class="docutils" />
<p>Metadata is also stored along with the main science data.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># all metadata</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># dB_mer metadata</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span>
<span class="c1"># units</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
<span class="c1"># update units for dB_mer</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;new_units&#39;</span><span class="p">}</span>
<span class="c1"># update display name, long_name</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;Fancy Name&#39;</span><span class="p">}</span>
<span class="c1"># add new meta data</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;fake&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;Display&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Data may be assigned to the instrument, with or without metadata.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;new_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
</pre></div>
</div>
<p>The same activities may be performed for other instruments in the same manner. In particular, for measurements from the Ion Velocity Meter and profiles of electron density from COSMIC, use</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># assignment with metadata</span>
<span class="n">ivm</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ivm&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ivm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
<span class="n">ivm</span><span class="p">[</span><span class="s1">&#39;double_mlt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="mf">2.</span><span class="o">*</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">],</span> <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;Double MLT&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;hours&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cosmic</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="s1">&#39;cosmic2013&#39;</span><span class="p">,</span><span class="s1">&#39;gps&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;ionprf&#39;</span><span class="p">,</span>  <span class="n">clean_level</span><span class="o">=</span><span class="s1">&#39;clean&#39;</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># requires CDAAC account</span>
<span class="n">cosmic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">cosmic</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
<span class="c1"># the profiles column has a DataFrame in each element which stores</span>
<span class="c1"># all relevant profile information indexed by altitude</span>
<span class="c1"># print part of the first profile, selection by integer location</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cosmic</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;profiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="c1"># print part of profile, selection by altitude value</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cosmic</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;profiles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">196</span><span class="p">:</span><span class="mi">207</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>Output for both print statements:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span>               <span class="n">ELEC_dens</span>    <span class="n">GEO_lat</span>    <span class="n">GEO_lon</span>
<span class="n">MSL_alt</span>
<span class="mf">196.465454</span>  <span class="mf">81807.843750</span> <span class="o">-</span><span class="mf">15.595786</span> <span class="o">-</span><span class="mf">73.431015</span>
<span class="mf">198.882019</span>  <span class="mf">83305.007812</span> <span class="o">-</span><span class="mf">15.585764</span> <span class="o">-</span><span class="mf">73.430191</span>
<span class="mf">201.294342</span>  <span class="mf">84696.546875</span> <span class="o">-</span><span class="mf">15.575747</span> <span class="o">-</span><span class="mf">73.429382</span>
<span class="mf">203.702469</span>  <span class="mf">86303.039062</span> <span class="o">-</span><span class="mf">15.565735</span> <span class="o">-</span><span class="mf">73.428589</span>
<span class="mf">206.106354</span>  <span class="mf">87460.015625</span> <span class="o">-</span><span class="mf">15.555729</span> <span class="o">-</span><span class="mf">73.427803</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-functions">
<h2>Custom Functions<a class="headerlink" href="#custom-functions" title="Permalink to this headline">¶</a></h2>
<p>Science analysis is built upon custom data processing. To simplify this task and enable instrument independent analysis, custom functions may be attached to the Instrument object. Each function is run automatically when new data is loaded before it is made available in .data.</p>
<p><strong>Modify Functions</strong></p>
<blockquote>
<div>The instrument object is passed to function without copying, modify in place.</div></blockquote>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_func_modify</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">optional_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">inst</span><span class="p">[</span><span class="s1">&#39;double_mlt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Add Functions</strong></p>
<blockquote>
<div>A copy of the instrument is passed to function, data to be added is returned.</div></blockquote>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_func_add</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">optional_param</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">2.</span><span class="o">*</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Add Function Including Metadata</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_func_add</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">optional_param1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional_param2</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="mf">2.</span><span class="o">*</span><span class="n">inst</span><span class="p">[</span><span class="s1">&#39;mlt&#39;</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;double_mlt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;long_name&#39;</span><span class="p">:</span><span class="s1">&#39;doubledouble&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;hours&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>Attaching Custom Function</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ivm</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">custom_func_modify</span><span class="p">,</span> <span class="s1">&#39;modify&#39;</span><span class="p">,</span> <span class="n">optional_param2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ivm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">ivm</span><span class="p">[</span><span class="s1">&#39;double_mlt&#39;</span><span class="p">])</span>
<span class="n">ivm</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">custom_func_add</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">optional_param2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ivm</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">)</span>
<span class="n">custom_complicated_analysis_over_season</span><span class="p">(</span><span class="n">ivm</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of custom_func_modify will always be available from instrument object, regardless of what level the science analysis is performed.</p>
<p>We can repeat the earlier VEFI example, this time using nano-kernel functionality.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">vefi</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vefi&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dc_b&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_vefi</span><span class="p">(</span><span class="n">inst</span><span class="p">):</span>
    <span class="c1"># select data near geographic equator</span>
    <span class="n">idx</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">vefi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span>
<span class="c1"># attach filter to vefi object, function is run upon every load</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filter_ivm</span><span class="p">,</span> <span class="s1">&#39;modify&#39;</span><span class="p">)</span>

<span class="c1"># create empty series to hold result</span>
<span class="n">mean_dB</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="c1"># get list of dates between start and stop</span>
<span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="c1"># iterate over season, calculate the mean absolute perturbation in</span>
<span class="c1"># meridional magnetic field</span>
<span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
     <span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
         <span class="c1"># compute mean absolute db_Mer using pandas functions and store</span>
         <span class="n">mean_dB</span><span class="p">[</span><span class="n">vefi</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># plot the result using pandas functionality</span>
<span class="n">mean_dB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mean Absolute Perturbation in Meridional Magnetic Field&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Perturbation (&#39;</span><span class="o">+</span><span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the same result is obtained. The VEFI instrument object and analysis are performed at the same level, so there is no strict gain by using the pysat nano-kernel in this simple demonstration. However, we can  use the nano-kernel to translate this daily mean into an versatile instrument independent function.</p>
<p><strong>Adding Instrument Independence</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">daily_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>

   <span class="c1"># create empty series to hold result</span>
   <span class="n">mean_val</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
   <span class="c1"># get list of dates between start and stop</span>
   <span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
   <span class="c1"># iterate over season, calculate the mean</span>
   <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># compute mean absolute db_Mer using pandas functions and store</span>
            <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">mean_val</span>

<span class="n">vefi</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vefi&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dc_b&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_vefi</span><span class="p">(</span><span class="n">inst</span><span class="p">):</span>
    <span class="c1"># select data near geographic equator</span>
    <span class="n">idx</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">vefi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">vefi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span>
<span class="c1"># attach filter to vefi object, function is run upon every load</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filter_ivm</span><span class="p">,</span> <span class="s1">&#39;modify&#39;</span><span class="p">)</span>

<span class="c1"># make a plot of daily dB_mer</span>
<span class="n">mean_dB</span> <span class="o">=</span> <span class="n">daily_mean</span><span class="p">(</span><span class="n">vefi</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">)</span>

<span class="c1"># plot the result using pandas functionality</span>
<span class="n">mean_dB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Absolute Daily Mean of &#39;</span>
             <span class="o">+</span> <span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute Daily Mean (&#39;</span><span class="o">+</span><span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The pysat nano-kernel lets you modify any data set as needed so that you can get the daily mean you desire, without having to modify the daily_mean function.</p>
<p>Check the instrument independence using a different instrument. Whatever instrument is supplied may be modified in arbitrary ways by the nano-kernel.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cosmic</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="s1">&#39;cosmic2013&#39;</span><span class="p">,</span><span class="s1">&#39;gps&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;ionprf&#39;</span><span class="p">,</span> <span class="n">clean_level</span><span class="o">=</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="n">altitude_bin</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_cosmic</span><span class="p">(</span><span class="n">inst</span><span class="p">):</span>
    <span class="n">cosmic</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cosmic</span><span class="p">[(</span><span class="n">cosmic</span><span class="p">[</span><span class="s1">&#39;edmaxlat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cosmic</span><span class="p">[</span><span class="s1">&#39;edmaxlat&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">)]</span>
    <span class="k">return</span>

<span class="n">cosmic</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filter_cosmic</span><span class="p">,</span> <span class="s1">&#39;modify&#39;</span><span class="p">)</span>
<span class="n">data_label</span> <span class="o">=</span> <span class="s1">&#39;edmax&#39;</span>
<span class="n">mean_max_dens</span> <span class="o">=</span> <span class="n">daily_mean</span><span class="p">(</span><span class="n">cosmic</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">data_label</span><span class="p">)</span>

<span class="c1"># plot the result using pandas functionality</span>
<span class="n">mean_max_dens</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Absolute Daily Mean of &#39;</span> <span class="o">+</span> <span class="n">cosmic</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute Daily Mean (&#39;</span><span class="o">+</span><span class="n">cosmic</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>daily_mean now works for any instrument, as long as the data to be averaged is 1D. This can be fixed.</p>
<p><strong>Partial Independence from Dimensionality</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">pysat</span>

<span class="k">def</span> <span class="nf">daily_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>

    <span class="c1"># create empty series to hold result</span>
    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="c1"># get list of dates between start and stop</span>
    <span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="c1"># iterate over season, calculate the mean</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># compute mean absolute using pandas functions and store</span>
            <span class="c1"># data could be an image, or lower dimension, account for 2D and lower</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="c1"># 3D data, 2D data at every time</span>
                <span class="n">data_panel</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]))</span>
                <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_panel</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="c1"># 2D data, 1D data for each time</span>
                <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">data_frame</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
                <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="c1"># 1D data</span>
                <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">return</span> <span class="n">mean_val</span>
</pre></div>
</div>
<p>This code works for 1D, 2D, and 3D datasets, regardless of instrument platform, with only some minor changes from the initial VEFI specific code. In-situ measurements, remote profiles, and remote images. It is true the nested if statements aren&#8217;t the most elegant. Particularly the 3D case. However this code puts the data into an appropriate structure for pandas to align each of the profiles/images by their respective indices before performing the average. Note that the line to obtain the arithmetic mean is the same in all cases, .mean(axis=0, skipna=True). There is an opportunity here for pysat to clean up the little mess caused by dimensionality.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">pysat</span>

<span class="k">def</span> <span class="nf">daily_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>

    <span class="c1"># create empty series to hold result</span>
    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="c1"># get list of dates between start and stop</span>
    <span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="c1"># iterate over season, calculate the mean</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># compute mean absolute using pandas functions and store</span>
            <span class="c1"># data could be an image, or lower dimension, account for 2D and lower</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">computational_form</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">return</span> <span class="n">mean_val</span>
</pre></div>
</div>
</div>
<div class="section" id="time-series-analysis">
<h2>Time Series Analysis<a class="headerlink" href="#time-series-analysis" title="Permalink to this headline">¶</a></h2>
<p>Pending</p>
</div>
<div class="section" id="iteration">
<h2>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h2>
<p>The seasonal analysis loop is repeated commonly:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">date_array</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">season_date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">)</span>
<span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_array</span><span class="p">:</span>
    <span class="n">vefi</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;Maximum meridional magnetic perturbation &#39;</span><span class="p">,</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p>Iteration support is built into the Instrument object to support this and similar cases. The whole VEFI data set may be iterated over on a daily basis using</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">vefi</span> <span class="ow">in</span> <span class="n">vefi</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;Maximum meridional magnetic perturbation &#39;</span><span class="p">,</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p>Each loop of the python for iteration initiates a vefi.load() for the next date, starting with the first available date. By default the instrument instance will iterate over all available data. To control the range, set the instrument bounds,</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># multi-season season</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">([</span><span class="n">start1</span><span class="p">,</span> <span class="n">start2</span><span class="p">],</span> <span class="p">[</span><span class="n">stop1</span><span class="p">,</span> <span class="n">stop2</span><span class="p">])</span>
<span class="c1"># continuous season</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="c1"># iterate over custom season</span>
<span class="k">for</span> <span class="n">vefi</span> <span class="ow">in</span> <span class="n">vefi</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;Maximum meridional magnetic perturbation &#39;</span><span class="p">,</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p>The output is,</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">vefi</span> <span class="n">dc_b</span> <span class="n">data</span> <span class="k">for</span> <span class="mi">05</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">10</span>
<span class="n">Maximum</span> <span class="n">meridional</span> <span class="n">magnetic</span> <span class="n">perturbation</span>  <span class="mf">19.3937</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">vefi</span> <span class="n">dc_b</span> <span class="n">data</span> <span class="k">for</span> <span class="mi">05</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">10</span>
<span class="n">Maximum</span> <span class="n">meridional</span> <span class="n">magnetic</span> <span class="n">perturbation</span>  <span class="mf">23.745</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">vefi</span> <span class="n">dc_b</span> <span class="n">data</span> <span class="k">for</span> <span class="mi">05</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">10</span>
<span class="n">Maximum</span> <span class="n">meridional</span> <span class="n">magnetic</span> <span class="n">perturbation</span>  <span class="mf">25.673</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">vefi</span> <span class="n">dc_b</span> <span class="n">data</span> <span class="k">for</span> <span class="mi">05</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span>
<span class="n">Maximum</span> <span class="n">meridional</span> <span class="n">magnetic</span> <span class="n">perturbation</span>  <span class="mf">26.583</span>
</pre></div>
</div>
<p>So far, the iteration support has only saved a single line of code, the .load line. However, this line in the examples above is tied to loading by date. What if we wanted to load by file instead? This would require changing the code. However, with the abstraction provided by the Instrument iteration, that is no longer the case.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">vefi</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span> <span class="s1">&#39;filename1&#39;</span><span class="p">,</span> <span class="s1">&#39;filename2&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">vefi</span> <span class="ow">in</span> <span class="n">vefi</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;Maximum meridional magnetic perturbation &#39;</span><span class="p">,</span> <span class="n">vefi</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p>For VEFI there is only one file per day so there is no practical difference between the previous example. However, for instruments that have more than one file a day, there is a difference.</p>
<p>Building support for this iteration into the mean_day example is easy.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">pysat</span>

<span class="k">def</span> <span class="nf">daily_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>

    <span class="c1"># create empty series to hold result</span>
    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># compute mean absolute using pandas functions and store</span>
            <span class="c1"># data could be an image, or lower dimension, account for 2D and lower</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">computational_form</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">mean_val</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean_val</span>
</pre></div>
</div>
<p>Since bounds are attached to the Instrument object, the start and stop dates for the season are no longer required as inputs. If a user forgets to specify the bounds, the loop will start on the first day of data and end on the last day.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># make a plot of daily dB_mer</span>
<span class="n">vefi</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="n">mean_dB</span> <span class="o">=</span> <span class="n">daily_mean</span><span class="p">(</span><span class="n">vefi</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">)</span>

<span class="c1"># plot the result using pandas functionality</span>
<span class="n">mean_dB</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Absolute Daily Mean of &#39;</span>
             <span class="o">+</span> <span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute Daily Mean (&#39;</span><span class="o">+</span><span class="n">vefi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;dB_mer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The abstraction provided by the iteration support is also used for the next section on orbit data.</p>
</div>
<div class="section" id="orbit-support">
<h2>Orbit Support<a class="headerlink" href="#orbit-support" title="Permalink to this headline">¶</a></h2>
<p>Pysat has functionality to determine orbits on the fly from loaded data. These orbits will span day breaks as needed (generally). Information about the orbit needs to be provided at initialization. The &#8216;index&#8217; is the name of the data to be used for determining orbits, and &#8216;kind&#8217; indicates type of orbit. See <a class="reference internal" href="api.html#pysat.Orbits" title="pysat.Orbits"><code class="xref any py py-class docutils literal"><span class="pre">pysat.Orbits</span></code></a> for latest inputs.</p>
<p>There are several orbits to choose from,</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>kind</strong></td>
<td><strong>method</strong></td>
</tr>
<tr class="row-even"><td>local time</td>
<td>Uses negative gradients to delineate orbits</td>
</tr>
<tr class="row-odd"><td>longitude</td>
<td>Uses negative gradients to delineate orbits</td>
</tr>
<tr class="row-even"><td>polar</td>
<td>Uses sign changes to delineate orbits</td>
</tr>
</tbody>
</table>
<p>Changes in universal time are also used to delineate orbits. Pysat compares any gaps to the supplied orbital period, nominally assumed to be 97 minutes. As orbit periods aren&#8217;t constant, a 100% success rate is not be guaranteed.</p>
<p>This section of pysat is still under development.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;mlt&#39;</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">:</span><span class="s1">&#39;local time&#39;</span><span class="p">}</span>
<span class="n">ivm</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cnofs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ivm&#39;</span><span class="p">,</span> <span class="n">orbit_info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span> <span class="n">clean_level</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Orbit determination acts upon data loaded in the ivm object, so to begin we must load some data.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ivm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
<p>Orbits may be selected directly from the attached .orbit class. The data for the orbit is stored in .data.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">ivm</span>  <span class="n">data</span> <span class="k">for</span> <span class="mi">12</span><span class="o">/</span><span class="mi">27</span><span class="o">/</span><span class="mi">12</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">ivm</span>  <span class="n">data</span> <span class="k">for</span> <span class="mi">12</span><span class="o">/</span><span class="mi">28</span><span class="o">/</span><span class="mi">12</span>
<span class="n">Loaded</span> <span class="n">Orbit</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<p>Note that getting the first orbit caused pysat to load the day previous, and then back to the current day. Orbits are one indexed though this will change. Pysat is checking here if the first orbit for 12/28/2012 actually started on 12/27/2012. In this case it does.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">ivm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">14.584000</span>    <span class="mf">0.002449</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">15.584000</span>    <span class="mf">0.006380</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">16.584000</span>    <span class="mf">0.010313</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">17.584000</span>    <span class="mf">0.014245</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">18.584000</span>    <span class="mf">0.018178</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float32</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">ivm</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:,</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">50.563000</span>    <span class="mf">23.985415</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">51.563000</span>    <span class="mf">23.989031</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">52.563000</span>    <span class="mf">23.992649</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">53.563000</span>    <span class="mf">23.996267</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">54.563000</span>    <span class="mf">23.999886</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float32</span>
</pre></div>
</div>
<p>Let&#8217;s go back an orbit.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">prev</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">ivm</span>  <span class="n">data</span> <span class="k">for</span> <span class="mi">12</span><span class="o">/</span><span class="mi">27</span><span class="o">/</span><span class="mi">12</span>
<span class="n">Loaded</span> <span class="n">Orbit</span><span class="p">:</span><span class="mi">15</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">ivm</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:,</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">09.584000</span>    <span class="mf">23.982796</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">10.584000</span>    <span class="mf">23.986725</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">11.584000</span>    <span class="mf">23.990656</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">12.584000</span>    <span class="mf">23.994587</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">13.584000</span>    <span class="mf">23.998516</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float32</span>
</pre></div>
</div>
<p>pysat loads the previous day, as needed, and returns the last orbit for 12/27/2012 that does not (or should not) extend into 12/28.</p>
<p>If we continue to iterate orbits using</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</pre></div>
</div>
<p>eventually the next day will be loaded to try and form a complete orbit. You can skip the iteration and just go for the last orbit of a day,</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span><span class="p">[]</span> <span class="p">:</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[]:</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">ivm</span>  <span class="n">data</span> <span class="k">for</span> <span class="mi">12</span><span class="o">/</span><span class="mi">29</span><span class="o">/</span><span class="mi">12</span>
<span class="n">Loaded</span> <span class="n">Orbit</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span><span class="p">[</span><span class="mi">72</span><span class="p">]</span> <span class="p">:</span> <span class="n">ivm</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">72</span><span class="p">]:</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">34.160000</span>    <span class="mf">0.003109</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">35.152000</span>    <span class="mf">0.007052</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">36.160000</span>    <span class="mf">0.010996</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">37.152000</span>    <span class="mf">0.014940</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">38.160000</span>    <span class="mf">0.018884</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float32</span>

<span class="n">In</span><span class="p">[</span><span class="mi">73</span><span class="p">]</span> <span class="p">:</span> <span class="n">ivm</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:,</span><span class="s1">&#39;mlt&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mf">13.119000</span>    <span class="mf">23.982937</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mf">14.119000</span>    <span class="mf">23.986605</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mf">15.119000</span>    <span class="mf">23.990273</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mf">16.119000</span>    <span class="mf">23.993940</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mf">17.119000</span>    <span class="mf">23.997608</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">mlt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float32</span>
</pre></div>
</div>
<p>Pysat loads the next day of data to see if the last orbit on 12/28/12 extends into 12/29/12, which it does. Note that the last orbit of 12/28/12 is the same as the first orbit of 12/29/12. Thus, if we ask for the next orbit,</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span><span class="p">[]</span> <span class="p">:</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="n">Loaded</span> <span class="n">Orbit</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
<p>pysat will indicate it is the second orbit of the day. Going back an orbit gives us orbit 16, but referenced to a different day. Earlier, the same orbit was labeled orbit 1.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span><span class="p">[]</span> <span class="p">:</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">prev</span><span class="p">()</span>
<span class="n">Returning</span> <span class="n">cnofs</span> <span class="n">ivm</span>  <span class="n">data</span> <span class="k">for</span> <span class="mi">12</span><span class="o">/</span><span class="mi">28</span><span class="o">/</span><span class="mi">12</span>
<span class="n">Loaded</span> <span class="n">Orbit</span><span class="p">:</span><span class="mi">16</span>
</pre></div>
</div>
<p>Orbit iteration is built into ivm.orbits just like iteration by day is built into ivm.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">pandas</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">stop</span> <span class="o">=</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">pandas</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">ivm</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ivm</span> <span class="ow">in</span> <span class="n">ivm</span><span class="o">.</span><span class="n">orbits</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;next available orbit &#39;</span><span class="p">,</span> <span class="n">ivm</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="section" id="iteration-and-instrument-independent-analysis">
<h2>Iteration and Instrument Independent Analysis<a class="headerlink" href="#iteration-and-instrument-independent-analysis" title="Permalink to this headline">¶</a></h2>
<p>Now we can generalize daily_mean into two functions, one that averages by day, the other by  orbit. Strictly speaking, the daily_mean above already does this with the right input.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">mean_daily_val</span> <span class="o">=</span> <span class="n">daily_mean</span><span class="p">(</span><span class="n">vefi</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">)</span>
<span class="n">mean_orbit_val</span> <span class="o">=</span> <span class="n">daily_mean</span><span class="p">(</span><span class="n">vefi</span><span class="o">.</span><span class="n">orbits</span><span class="p">,</span> <span class="s1">&#39;dB_mer&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the output of the by_orbit attempt gets rewritten for most orbits since the output from daily_mean is stored by date. Though this could be fixed, supplying an instrument object/iterator in one case and an orbit iterator in the other might be a bit inconsistent. Even if not, let&#8217;s try another route.</p>
<p>We also don&#8217;t want to maintain two code bases that do almost the same thing. So instead, let&#8217;s create three functions, two of which simply call a hidden third.</p>
<p><strong>Iteration Independence</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">daily_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mean of data_label by day/file over Instrument.bounds&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_core_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">,</span> <span class="n">by_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">by_orbit_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mean of data_label by orbit over Instrument.bounds&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_core_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">,</span> <span class="n">by_orbit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_core_mean</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">data_label</span><span class="p">,</span> <span class="n">by_orbit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by_day</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">by_orbit</span><span class="p">:</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">orbits</span>
    <span class="k">elif</span> <span class="n">by_day</span><span class="p">:</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">inst</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;A choice must be made, by day/file, or by orbit&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">by_orbit</span> <span class="ow">and</span> <span class="n">by_day</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;A choice must be made, by day/file, or by orbit&#39;</span><span class="p">)</span>

    <span class="c1"># create empty series to hold result</span>
    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="c1"># iterate over season, calculate the mean</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
           <span class="k">if</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
               <span class="c1"># compute mean absolute using pandas functions and store</span>
               <span class="c1"># data could be an image, or lower dimension, account for 2D and lower</span>
               <span class="n">data</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span>
               <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

               <span class="k">if</span> <span class="n">by_orbit</span><span class="p">:</span>
                   <span class="n">date</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">date</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">date</span>

               <span class="n">data</span> <span class="o">=</span> <span class="n">pysat</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">computational_form</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
               <span class="n">mean_val</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">iterator</span>
    <span class="k">return</span> <span class="n">mean_val</span>
</pre></div>
</div>
<p>The addition of a few more lines to the daily_mean function adds support for averages by orbit, or by day, for any platform with data 3D or less. The date issue and the type of iteration are solved with simple if else checks. From a practical perspective, the code doesn&#8217;t really deviate from the first solution of simply passing in vefi.orbits, except for the fact that the .orbits switch is &#8216;hidden&#8217; in the code. NaN values are also dropped from the data. If the first element is a NaN, it isn&#8217;t handled by the simple instance check.</p>
<p>A name change and a couple more dummy functions separates out the orbit vs daily iteration clearly, without having multiple codebases. Iteration by file and by date are handled by the same Instrument iterator, controlled by the settings in Instrument.bounds. A by_file_mean was not created because bounds could be set by date and then by_file_mean applied. Of course this could set up to produce an error. However, the settings on Instrument.bounds controls the iteration type between files and dates, so we maintain this view with the expressed calls. Similarly, the orbit iteration is a separate iterator, with a separate call. This technique above is used by other seasonal analysis routines in pysat.</p>
<p>You may notice that the mean call could also easily be replaced by a median, or even a mode. We might also want to return the standard deviation, or appropriate measure. Perhaps another level of generalization is needed?</p>
</div>
<div class="section" id="summary-flow-charts">
<h2>Summary Flow Charts<a class="headerlink" href="#summary-flow-charts" title="Permalink to this headline">¶</a></h2>
<img alt="_images/pysat_load_flow_chart.png" src="_images/pysat_load_flow_chart.png" />
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Code Examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Russell Stoneback.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>